/*! project-name v0.0.1 | (c) 2021 YOUR NAME | MIT License | http://link-to-your-git-repo.com */
const arrowsToggle=document.querySelector(".arrows-toggle"),aboutToggle=document.querySelector(".about"),carouselArrows=document.querySelector(".glide__arrows");let dataFundraising,largeScreen=window.innerWidth>1100,villageNameIsSticky=!1;const dataPath=window.location.href.includes("dist")?"../dist/data/fundraising_level_per_community.csv":"../data/fundraising_level_per_community.csv";d3.csv(dataPath).then(e=>{dataFundraising=e,appendCommunities()});let fundLevelParam=urlParams.get("fund-level");const appendCommunities=()=>{let e="";e=urlParams.get("community")?urlParams.get("community"):"cerro-de-leones";const l=villagesData.findIndex(l=>l.village_id===e),t=villagesData[l].village_name;let i=e;d3.select("#first-community").text(t),urlParams.get("version")&&"youth"===urlParams.get("version")&&d3.select("body").classed("youth",!0);const s=d3.select(".glide__slides").selectAll(".glide__slide").data(villagesData).join("li").attr("class","glide__slide").append("div").attr("class",e=>`village village-${e.village_id}`);s.append("h2").text(e=>e.village_name);const a=s.append("div").attr("class","sections").selectAll(".section").data(e=>e.sections).join("div").attr("class",e=>`section section-${e.sct_id}`);a.append("div").attr("class","sct-illustration").html(e=>e.illustration),a.append("div").attr("class","sct-description").html(e=>"es"===lang?e.description_es:e.description_en),currentVillage=d3.select(".current-village"),currentVillage.append("h2").text(villagesData.find(e=>e.village_id===i).village_name);let n=null!==fundLevelParam?+fundLevelParam:+dataFundraising.find(l=>l.community===e).fundraising_level;triggerAnimations(e,n);const o=new Glide(".glide",{type:"carousel",focusAt:"center",perView:1,startAt:l}).mount(),r=e=>{const l=villagesData[e-1]?villagesData[e-1]:villagesData[villagesData.length-1];d3.select(".glide__arrow--left .btn-label").text(l.village_name);const t=villagesData[e+1]?villagesData[e+1]:villagesData[0];d3.select(".glide__arrow--right .btn-label").text(t.village_name)},c=e=>{const l=i;gsap.globalTimeline.clear();const t=villagesData[e];i=t.village_id,currentVillage.select("h2").text(t.village_name),n=null!==fundLevelParam?+fundLevelParam:+dataFundraising.find(e=>e.community===t.village_id).fundraising_level,triggerAnimations(i,n),(e=>{d3.selectAll(`.village-${e} .section-community .sct-illustration svg`).remove(),d3.selectAll(`.village-${e} .section-community .sct-illustration`).html(villagesData.find(l=>l.village_id===e).sections.find(e=>"community"===e.sct_id).illustration),d3.selectAll(`.village-${e} .section-school .sct-illustration svg`).remove(),d3.selectAll(`.village-${e} .section-school .sct-illustration`).html(villagesData.find(l=>l.village_id===e).sections.find(e=>"school"===e.sct_id).illustration),d3.selectAll(`.village-${e} .section-distance .sct-illustration svg`).remove(),d3.selectAll(`.village-${e} .section-distance .sct-illustration`).html(villagesData.find(l=>l.village_id===e).sections.find(e=>"distance"===e.sct_id).illustration),d3.selectAll(`.village-${e} .section-waterMCL .sct-illustration svg`).remove(),d3.selectAll(`.village-${e} .section-waterMCL .sct-illustration`).html(villagesData.find(l=>l.village_id===e).sections.find(e=>"waterMCL"===e.sct_id).illustration),d3.selectAll(`.village-${e} .section-solution .sct-illustration svg`).remove(),d3.selectAll(`.village-${e} .section-solution .sct-illustration`).html(villagesData.find(l=>l.village_id===e).sections.find(e=>"solution"===e.sct_id).illustration),d3.selectAll(`.village-${e} .section-coloring .sct-illustration svg`).remove(),d3.selectAll(`.village-${e} .section-coloring .sct-illustration`).html(villagesData.find(l=>l.village_id===e).sections.find(e=>"coloring"===e.sct_id).illustration)})(l)};window.innerWidth>1100&&r(o.index),o.on("run",()=>{window.innerWidth>1100&&r(o.index),c(o.index)});d3.selectAll(".map-peru .map-description");const d=()=>{const e=1.5*document.querySelector(".map-peru").getBoundingClientRect().width;d3.selectAll(".map-peru .map-image").style("height",`${e}px`),d3.selectAll(".map-peru .map-description").style("height",`${e}px`)};d(),window.addEventListener("resize",()=>{window.innerWidth>1100&&!largeScreen?(largeScreen=!0,r(o.index)):window.innerWidth<=1100&&largeScreen&&(largeScreen=!1),d()});const g=document.querySelector(".village h2");window.addEventListener("scroll",()=>{const e=largeScreen?300:-125;aboutToggle.offsetTop-window.pageYOffset<=window.innerHeight/2+70?carouselArrows.classList.contains("exit")||(carouselArrows.classList.remove("enter"),carouselArrows.classList.add("exit")):arrowsToggle.getBoundingClientRect().top<=e?(carouselArrows.classList.contains("hidden")&&carouselArrows.classList.remove("hidden"),carouselArrows.classList.contains("enter")||(carouselArrows.classList.remove("exit"),carouselArrows.classList.add("enter"))):arrowsToggle.getBoundingClientRect().top>e&&!carouselArrows.classList.contains("exit")&&(carouselArrows.classList.remove("enter"),carouselArrows.classList.add("exit")),aboutToggle.offsetTop-window.pageYOffset<=window.innerHeight/2+70?(currentVillage.classed("visible",!1),villageNameIsSticky=!1):g.getBoundingClientRect().top<-50&&!villageNameIsSticky?(currentVillage.classed("visible",!0),villageNameIsSticky=!0):g.getBoundingClientRect().top>=-50&&villageNameIsSticky&&(currentVillage.classed("visible",!1),villageNameIsSticky=!1)})};